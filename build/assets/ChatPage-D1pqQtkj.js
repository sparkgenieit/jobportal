import{p as R,r as i,c as S,j as s,S as I,T as M,h as g}from"./index-DW7Jtefv.js";import{u as P,i as h,O as v,Q as k,n as A}from"./index-BjWyLh7X.js";import{M as C}from"./ShowMore-aN4txTUv.js";function D({name:T}){var p;const u=R(),[t,b]=i.useState({}),[r,c]=i.useState({}),[n,l]=i.useState({}),m=P(),o=S(),x=async e=>{try{const a=await g.get(`/mails/employer/details/${e}`);b(a.data)}catch(a){m({status:"error",error:a})}},f=e=>{c({...r,message:e}),l({...n,errorInPostingReply:(e==null?void 0:e.trim())===""?"Please enter message":null})};function y(e){return e.toReversed()}const j=async()=>{var e,a;if(r.message&&((e=r.message)==null?void 0:e.trim())!==""){l({...n,sendingReply:!0});const d={...r};(a=t.participants)!=null&&a.includes("Visitor")&&(d.message=A(d.message));try{const N=await g.put(`/mails/employer/reply/${t._id}`,d);l({showMessageBox:!1,sendingReply:!1,errorInPostingReply:null}),c({}),x(t._id)}catch{l({...n,sendingReply:!1,errorInPostingReply:"Something went wrong! Please try again"})}}else l({...n,errorInPostingReply:"Please enter message"})},w=()=>{const e=o.role==="recruiter"?`${o.name}(${o.companyId.first_name+" "+o.companyId.last_name})`:o.first_name+" "+o.last_name,a={date:new Date,by:o.role,message:"",from:e};c(a),l({...n,showMessageBox:!0})};return i.useEffect(()=>{document.title="Inbox";const e=u.id;x(e)},[]),s.jsxs("div",{className:"mt-3 container",children:[s.jsx("button",{onClick:()=>m({path:-1}),type:"button",className:" bg-gray-600 active:bg-gray-300 text-white font-semibold p-2 rounded-full ",children:s.jsx(I,{fontSize:16})}),s.jsxs("div",{className:" mt-3 flex flex-col md:flex-row gap-3 items-center",children:[s.jsx("h2",{className:" grow font-bold text-xl ",children:t==null?void 0:t.subject}),s.jsx("span",{className:"self-end",children:s.jsx("button",{onClick:()=>w(),disabled:n.showMessageBox,className:"bg-blue-500 rounded-lg px-3 py-2 active:bg-blue-300 text-white",type:"button",children:"Send Message"})})]}),s.jsxs("div",{className:" mt-3 ",children:[n.showMessageBox&&s.jsxs("div",{children:[s.jsx("p",{className:`font-bold text-lg ${r.by==="admin"?"text-blue-600":"text-black"}`,children:r.from}),s.jsx("p",{children:h(r==null?void 0:r.date)}),s.jsxs("div",{className:"flex flex-wrap",children:[s.jsx("div",{className:"grow",children:s.jsx(C,{value:r.message,setValue:f})}),s.jsx("button",{type:"button",disabled:n.sendingReply,onClick:j,className:"bg-emerald-400  active:bg-emerald-200 text-white  self-end rounded-lg p-2",children:s.jsx(M,{fontSize:20})})]}),n.errorInPostingReply&&s.jsx("small",{className:"text-red-600",children:n.errorInPostingReply})]}),(t==null?void 0:t.chat)&&((p=y(t==null?void 0:t.chat))==null?void 0:p.map((e,a)=>s.jsxs("div",{className:" border-b p-3",children:[s.jsx("p",{className:`fw-bold text-lg ${e.by==="admin"?"text-blue-600":"text-black"}`,children:e.from}),s.jsxs("p",{children:[h(e==null?void 0:e.date)," (",v(new Date(e==null?void 0:e.date).toISOString()),")"]}),s.jsx("div",{className:"text-wrap",children:k(e.message)})]},a)))]})]})}export{D as C};
